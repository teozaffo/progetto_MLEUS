<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Decision Tree for Pancreatic Ductal Adenocarcinoma</title>

  <style>

    body {

      font-family: Arial, sans-serif;

      background: #f8f9fa;

      margin: 0;

      padding: 2rem;

    }

    .container {

      max-width: 600px;

      margin: auto;

      background: #ffffff;

      padding: 2rem;

      border-radius: 8px;

      box-shadow: 0 4px 12px rgba(0,0,0,0.1);

    }

    h2 {

      text-align: center;

      margin-bottom: 1.5rem;

    }

    label {

      display: block;

      margin-top: 1rem;

    }

    input {

      width: 100%;

      padding: 0.5rem;

      margin-top: 0.25rem;

      border: 1px solid #ccc;

      border-radius: 4px;

    }

    button {

      margin-top: 1.5rem;

      padding: 0.75rem;

      width: 100%;

      background-color: #007bff;

      border: none;

      color: white;

      font-size: 1rem;

      border-radius: 4px;

      cursor: pointer;

    }

    button:hover {

      background-color: #0056b3;

    }

    .result {

      margin-top: 2rem; /* Stacca la casella dal bottone */

      padding: 1.5rem; /* Aggiunge pi√π spazio interno alla casella */

      border-radius: 8px; /* Arrotonda gli angoli */

      text-align: center; /* Centra il testo orizzontalmente */

      font-size: 1.5rem; /* Ingrossa il testo */

      font-weight: bold; /* Rende il testo pi√π marcato */

      display: flex; /* Per centrare il testo verticalmente */

      align-items: center; /* Centra il testo verticalmente */

      justify-content: center; /* Centra il testo orizzontalmente */

      width: 100%; /* Rende la casella larga quanto il pulsante */

      box-sizing: border-box; /* Include padding e bordo nella larghezza */

    }

    .error {

      color: red;

      margin-top: 1rem;

      text-align: center;

    }

	.form-row {

	display: flex;

	justify-content: space-between;

	align-items: center;

	margin-top: 1rem;

	}



	.form-row label {

	flex: 1;

	}

  .form-row select {
    
    width: 20%;

  }

  .form-row input {
    
    width: 17%;

  }
  
  .btn-group {

    display: flex;

    flex-direction: row;

    justify-content: center;

  }

  .model-btn {
    border: solid 2px #000;
    background-color: white;
    color: black;
    padding: 10px 24px;
    font-size: 15px;
    cursor: pointer;
    border-color:#007bff;
    margin-top: 0cm;
  }

  .model-btn:hover {
    color: #ffffff;
    background-color: #007bff;
    border-color: #007bff;
  }

  .mandatory {

    padding: 0.5rem;

    margin-left: 1rem;

    border: 2px solid red;

    border-radius: 4px;
  }

  .optional {

    padding: 0.5rem;

    margin-left: 1rem;

    border: 2px solid #ccc;

    border-radius: 4px;
  }

  .information {
    
    font-weight: bold;
    
    color: red;

  }

  </style>

  <script type="text/javascript" src="../static/index.js"></script>

</head>

<body>

  <div class="container">

    <h2>Predictors for Pancreatic Ductal Adenocarcinoma</h2>

    <!-- <div id="connectionInfo" style="text-align: center; font-size: 0.95rem; color: #444; margin-bottom: 1.5rem;">
      Caricamento informazioni di connessione...
    
	</div> -->

    <h3> Select the Model you prefer :</h3>

    <div class="btn-group">
      <button class="model-btn" id="DT">Sensitive (DT)</button>
      <button class="model-btn" id="NB">Balanced (NB)</button>
      <button class="model-btn" id="LR">Specific (LR)</button>
    </div>

<form id="inputForm DT">

  <div class="form-row">

    <label for="Age">Age:</label>

    <input id="Age" type="text">

  </div>

  <div class="form-row">

    <label for="Sex">Sex</label>

    <select id="Sex">

      <option value="0">Female</option>

      <option value="1">Male</option>

    </select>

  </div>

  <div class="form-row">

    <label for="Dim1">Max Dimension</label>

    <input id="Dim1" type="text" placeholder="(in mm)">

  </div>

  <div class="form-row">

    <label for="Dim2">Min Dimension</label>

    <input id="Dim2" type="text" placeholder="(in mm)">

  </div>

  <div class="form-row">

    <label for="Veins">Veinous Infiltration</label>

    <select id="Veins">

      <option value="0">False</option>
      
      <option value="1">True</option>

    </select>

  </div>

  <div class="form-row">

    <label for="Arteries">Arterious Infiltration</label>

    <select id="Arteries">

      <option value="0">False</option>
      
      <option value="1">True</option>

    </select>

  </div>

  <div class="form-row">

    <label for="DuctRetrodilatation">Duct Retrodilatation, Ductal Invasion</label>

    <select id="DuctRetrodilatation">

      <option value="0" selected>False</option>

      <option value="1">True</option>

    </select>

  </div>



  <div class="form-row">

    <label for="VesselCompression">Vessel Compression</label>

    <select id="VesselCompression">

      <option value="0" selected>False</option>

      <option value="1">True</option>

    </select>

  </div>



  <div class="form-row">

    <label for="Lymphadenopathy">Lymphadenopathy</label>

    <select id="Lymphadenopathy">

      <option value="0" selected>False</option>

      <option value="1">True</option>

    </select>

  </div>



  <div class="form-row">

    <label for="Margins">Regular Margins</label>

    <select id="Margins">

      <option value="0" selected>False</option>

      <option value="1">True</option>

    </select>

  </div>



  <div class="form-row">

    <label for="Ecostructure">Echogenicity</label>

    <select id="Ecostructure">

      <option value="0" selected>Ipoechoic</option>

      <option value="1">Iso/iperechoic</option>

    </select>

  </div>

  <div class="form-row">

    <label for="Multiple">Multiple Lesions</label>

    <select id="Multiple">

      <option value="0">False</option>
      
      <option value="1">True</option>

    </select>

  </div>
  
  <div class="form-row">
  
  <label for="HospitalCenter">Hospital Center</label>
  
  <input id="HospitalCenter" type="text" class="optional">
  
</div>

<div class="form-row">

  <label for="ProtocolCode">Protocol Code</label>
  
  <input id="ProtocolCode" type="text" class="optional">
  
</div>

  <p class="information"><br>*fields with red borders are mandatory fields!!</p>

  <button type="button" onclick="predictClass()">Classify</button>
  
  <div class="error" id="validationError" style="color: red; margin-top: 1rem; text-align: center;"></div>


</form>

    <div class="result" id="result"></div>

    <div class="error" id="error"></div>

  </div>



  <script>
    async function sendToServer(data) {
      try {
      await fetch("/salva", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      } catch (error) {
      console.error("Errore nell'invio al server:", error);
      }
    }
	

	let selectedModel = "DT"; // default all'avvio


	async function predictClass() {
	  // üîÑ Ripristina colore bianco a tutti i campi
	  allFeatures.forEach(id => {
		document.getElementById(id).style.backgroundColor = "white";
	  });

	  // ‚ùó Messaggio di errore per i campi obbligatori
	  const validationError = document.getElementById("validationError");
	  validationError.innerText = "";

	  const missing = validateMandatoryFields();

	  if (missing.length > 0) {
		const labels = missing.map(id => document.querySelector(`label[for="${id}"]`).innerText);
		validationError.innerText = `‚ö†Ô∏è Compila i seguenti campi obbligatori: ${labels.join(', ')}`;

		// üî∂ Evidenzia i campi mancanti
		missing.forEach(id => {
		  document.getElementById(id).style.backgroundColor = "#fff3cd";
		});

		return;
	  }

      const D = parseInt(document.getElementById('DuctRetrodilatation').value);

      const V = parseInt(document.getElementById('VesselCompression').value);

      const L = parseInt(document.getElementById('Lymphadenopathy').value);

      const M = parseInt(document.getElementById('Margins').value);

      const E = parseInt(document.getElementById('Ecostructure').value);



      const errorDiv = document.getElementById('error');

      const resultDiv = document.getElementById('result');

      errorDiv.innerText = '';

      resultDiv.innerText = '';

      resultDiv.style.backgroundColor = '';

      resultDiv.style.color = '';



      if ([D, V, L, M, E].some(v => isNaN(v))) {

        errorDiv.innerText = 'Please enter valid numeric values for all fields using dot (.) as decimal separator.';

        return;

      }



      let result = 'uncertain case';

      let color = 'black';

      let boxColor = 'white';



      // Define all conditions as rule blocks

      const rules = [

       		{ c: () => D === 0 && V === 0 && L === 0 && M === 0 && E === 0, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#8282FF' },

		{ c: () => D === 0 && V === 0 && L === 0 && M === 0 && E === 1, r: 'Likely NOT Malignant', textColor: 'white', boxColor: '#000096' },

		{ c: () => D === 0 && V === 0 && L === 0 && M === 1 && E === 0, r: 'Likely NOT Malignant', textColor: 'white', boxColor: '#000096' },

		{ c: () => D === 0 && V === 0 && L === 0 && M === 1 && E === 1, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#8282FF' },

		

		{ c: () => D === 0 && V === 0 && L === 1 && M === 0 && E === 0, r: 'Likely Malignant', textColor: 'black', boxColor: '#FFE6E6' },
		
		{ c: () => D === 0 && V === 0 && L === 1 && M === 0 && E === 1, r: 'uncertain case', textColor: 'black', boxColor: '#F2F2F2' },

		{ c: () => D === 0 && V === 0 && L === 1 && M === 1 && E === 0, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#8282FF' },

		{ c: () => D === 0 && V === 0 && L === 1 && M === 1 && E === 1, r: 'Likely NOT Malignant', textColor: 'white', boxColor: '#000096' },

		

		{ c: () => D === 0 && V === 1 && M === 0 && L === 0 && E === 0, r: 'Likely Malignant', textColor: 'black', boxColor: '#FFE6E6' },

		{ c: () => D === 0 && V === 1 && M === 0 && L === 0 && E === 1, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#E6E6FF' },

		{ c: () => D === 0 && V === 1 && M === 0 && L === 1 && E === 0, r: 'Likely Malignant', textColor: 'black', boxColor: '#FF8282' },

		{ c: () => D === 0 && V === 1 && M === 0 && L === 1 && E === 1, r: 'Likely NOT Malignant', textColor: 'white', boxColor: '#000096' },

		

		{ c: () => D === 0 && V === 1 && M === 1 && L === 0 && E === 0, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#8282FF' },

		{ c: () => D === 0 && V === 1 && M === 1 && L === 0 && E === 1, r: 'Likely NOT Malignant', textColor: 'white', boxColor: '#000096' },

		{ c: () => D === 0 && V === 1 && M === 1 && L === 1 && E === 0, r: 'Likely NOT Malignant', textColor: 'white', boxColor: '#000096' },

		{ c: () => D === 0 && V === 1 && M === 1 && L === 1 && E === 1, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#8282FF' },

		

		{ c: () => D === 1 && M === 0 && E === 0 && L === 0 && V === 0, r: 'Likely Malignant', textColor: 'black', boxColor: '#FF8282' },

		{ c: () => D === 1 && M === 0 && E === 0 && L === 0 && V === 1, r: 'Likely Malignant', textColor: 'black', boxColor: '#DC4646' },

		{ c: () => D === 1 && M === 0 && E === 0 && L === 1 && V === 0, r: 'Likely Malignant', textColor: 'white', boxColor: '#960000' },

		{ c: () => D === 1 && M === 0 && E === 0 && L === 1 && V === 1, r: 'Likely Malignant', textColor: 'black', boxColor: '#DC4646' },

		

		{ c: () => D === 1 && M === 0 && E === 1 && V === 0 && L === 0, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#B4B4FF' },
		
		{ c: () => D === 1 && M === 0 && E === 1 && V === 0 && L === 1, r: 'uncertain case', textColor: 'black', boxColor: '#F2F2F2' },

		{ c: () => D === 1 && M === 0 && E === 1 && V === 1 && L === 0, r: 'Likely Malignant', textColor: 'black', boxColor: '#FF8282' },

		{ c: () => D === 1 && M === 0 && E === 1 && V === 1 && L === 1, r: 'Likely Malignant', textColor: 'black', boxColor: '#FF8282' },

		

		{ c: () => D === 1 && M === 1 && E === 0 && L === 0 && V === 0, r: 'Likely NOT Malignant', textColor: 'black', boxColor: '#B4B4FF' },

		{ c: () => D === 1 && M === 1 && E === 0 && L === 0 && V === 1, r: 'uncertain case', textColor: 'black', boxColor: '#F2F2F2' },

		{ c: () => D === 1 && M === 1 && E === 0 && L === 1 && V === 0, r: 'Likely Malignant', textColor: 'black', boxColor: '#FFB4B4' },

		{ c: () => D === 1 && M === 1 && E === 0 && L === 1 && V === 1, r: 'uncertain case', textColor: 'black', boxColor: '#F2F2F2' },

		

		{ c: () => D === 1 && M === 1 && E === 1 && V === 0 && L === 0, r: 'uncertain case', textColor: 'black', boxColor: '#F2F2F2' },
		
		{ c: () => D === 1 && M === 1 && E === 1 && V === 0 && L === 1, r: 'uncertain case', textColor: 'black', boxColor: '#F2F2F2' },

		{ c: () => D === 1 && M === 1 && E === 1 && V === 1 && L === 0, r: 'Likely Malignant', textColor: 'black', boxColor: '#FF8282' },
		
		{ c: () => D === 1 && M === 1 && E === 1 && V === 1 && L === 1, r: 'uncertain case', textColor: 'black', boxColor: '#F2F2F2' },



      ];



	for (let rule of rules) {

  	if (rule.c()) {

    	result = rule.r;

    	textColor = rule.textColor; // Recupera il colore del testo dalla regola

    	boxColor = rule.boxColor;   // Recupera il colore di sfondo dalla regola

    	break;

  	}

	}



	resultDiv.innerText = `:: ${result} ::`;

	resultDiv.style.color = textColor; // Applica il colore del testo

	resultDiv.style.backgroundColor = boxColor; // Applica il colore di sfondo
  // Dopo aver calcolato il risultato, raccogli i dati:
	const formData = {
	  model: selectedModel,
	  datetime: new Date().toISOString(),

	  Age: parseInt(document.getElementById("Age").value),
	  Sex: parseInt(document.getElementById("Sex").value),
	  Dim1: parseFloat(document.getElementById("Dim1").value),
	  Dim2: parseFloat(document.getElementById("Dim2").value),
	  Veins: parseInt(document.getElementById("Veins").value),
	  Arteries: parseInt(document.getElementById("Arteries").value),
	  DuctRetrodilatation: parseInt(document.getElementById("DuctRetrodilatation").value),
	  VesselCompression: parseInt(document.getElementById("VesselCompression").value),
	  Lymphadenopathy: parseInt(document.getElementById("Lymphadenopathy").value),
	  Margins: parseInt(document.getElementById("Margins").value),
	  Ecostructure: parseInt(document.getElementById("Ecostructure").value),
	  Multiple: parseInt(document.getElementById("Multiple").value),
	  HospitalCenter: document.getElementById("HospitalCenter").value.trim(),
	  ProtocolCode: document.getElementById("ProtocolCode").value.trim(),
	  prediction: result
	};
	  
	      // Ottieni l‚ÄôIP pubblico
    try {
      const res = await fetch('https://api.ipify.org?format=json');
      const data = await res.json();
      formData.ip = data.ip;
    } catch (e) {
      formData.ip = "IP non disponibile";
    }

    sendToServer(formData);
  }
  </script>
  
  <script>
		  // Mostra IP e data/ora
  async function showConnectionInfo() {
    try {
      const res = await fetch('https://api.ipify.org?format=json');
      const data = await res.json();
      const ip = data.ip;
      const now = new Date().toLocaleString();
      document.getElementById("connectionInfo").innerText = `Indirizzo IP: ${ip} | Connessione: ${now}`;
    } catch (e) {
      document.getElementById("connectionInfo").innerText = "Impossibile recuperare l'indirizzo IP.";
    }
  }

  showConnectionInfo();
  </script>
</body>

</html>
